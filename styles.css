body { margin: 0; display: flex; height: 100vh; font-family: "Microsoft JhengHei", Arial, sans-serif; background: #f4f4f4; overflow: hidden; }

/* 地圖與儀表板佈局 */
#map-container { position: relative; width: 70%; height: 100%; z-index: 1; }
#map { width: 100%; height: 100%; }
#dashboard { width: 30%; background: #fff; display: flex; flex-direction: column; padding: 15px; box-shadow: -2px 0 15px rgba(0,0,0,0.1); z-index: 2; overflow-y: auto; }

/* 側欄時鐘 */
.side-clock { background: #2c3e50; color: #00d2ff; padding: 15px; border-radius: 8px; margin-bottom: 15px; text-align: center; border-left: 5px solid #00d2ff; }
#side-time { font-size: 28px; font-weight: bold; font-family: monospace; letter-spacing: 2px; }
#lunar-info { font-size: 13px; color: #bdc3c7; margin-top: 5px; }

/* 開場煙火視窗 */
.modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: flex; align-items: center; justify-content: center; }
#fireworks-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
.happy-new-year-content { position: relative; z-index: 10; text-align: center; color: white; pointer-events: none; }
.brand-text { font-size: 24px; letter-spacing: 5px; opacity: 0.8; margin-bottom: 10px; }
.wish-text { font-size: 48px; font-weight: bold; color: gold; text-shadow: 0 0 20px rgba(255, 215, 0, 0.8); animation: pulse 2s infinite; }
.close-btn { position: absolute; top: 50px; right: 50px; z-index: 20; padding: 10px 25px; background: transparent; border: 2px solid #fff; color: #fff; font-size: 16px; border-radius: 50px; cursor: pointer; transition: 0.3s; pointer-events: auto; }
.close-btn:hover { background: #fff; color: #000; }

@keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }

/* 控制面板元件 */
.control-panel { background: #fff; }
.sync-toggle-group { background: #f8f9fa; padding: 12px; border-radius: 6px; margin-bottom: 15px; border: 1px solid #eee; }
.sync-toggle-box { display: flex; align-items: center; justify-content: space-between; font-weight: bold; color: #333; }

/* 開關 Switch */
.switch { position: relative; display: inline-block; width: 40px; height: 22px; }
.switch input { opacity: 0; width: 0; height: 0; }
.slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
.slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
input:checked + .slider { background-color: #9b59b6; }
input:checked + .slider:before { transform: translateX(18px); }

/* 下拉選單與按鈕 */
.filter-row { display: flex; gap: 10px; margin-bottom: 15px; }
.control-group { flex: 1; }
.control-group label { font-size: 12px; color: #7f8c8d; display: block; margin-bottom: 4px; }
select { width: 100%; padding: 8px; border: 1px solid #bdc3c7; border-radius: 4px; background: #fff; }

.btn-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 15px; }
button { padding: 10px; border: none; border-radius: 4px; color: white; cursor: pointer; font-weight: bold; font-size: 13px; transition: 0.2s; }
.btn-locate { background: #3498db; }
.btn-chart { background: #9b59b6; }
.btn-refresh { background: #e67e22; }
button:hover { opacity: 0.9; transform: translateY(-1px); }

/* 狀態列與清單 */
.status-console { background: #2c3e50; color: #2ecc71; padding: 8px; font-size: 12px; border-radius: 4px; font-family: monospace; text-align: center; margin-bottom: 10px; }
.station-list { flex: 1; overflow-y: auto; }
.station-card { background: #fff; border: 1px solid #eee; padding: 10px; margin-bottom: 8px; border-radius: 4px; cursor: pointer; transition: 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
.station-card:hover { background: #f7f9f9; transform: translateX(3px); }

/* 浮動圖表視窗 */
.floating-window { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 500px; background: #fff; border-radius: 8px; z-index: 5000; box-shadow: 0 10px 30px rgba(0,0,0,0.3); border: 1px solid #ddd; display: none; }
.window-header { background: #34495e; color: #fff; padding: 10px 15px; border-radius: 8px 8px 0 0; display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
.close-x { cursor: pointer; font-size: 20px; color: #fff; }
.window-content { padding: 15px; background: #fff; border-radius: 0 0 8px 8px; }

/* 地圖上的浮動元件 */
.map-floating-timer { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.7); color: gold; padding: 5px 15px; border-radius: 20px; z-index: 1000; font-family: monospace; border: 1px solid gold; font-size: 14px; }
.map-floating-legend { position: absolute; bottom: 30px; left: 20px; background: white; padding: 10px; border-radius: 8px; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.2); width: 140px; }
.legend-header { font-weight: bold; cursor: pointer; display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 5px; font-size: 13px; }
.legend-item { display: flex; align-items: center; font-size: 12px; margin-bottom: 4px; }
.dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 8px; }
.green { background: #28a745; } .yellow { background: #ffc107; } .orange { background: #fd7e14; } .red { background: #dc3545; } .gray { background: #6c757d; }

/* 手機版適配 */
@media (max-width: 768px) {
    body { flex-direction: column; }
    #map-container { width: 100%; height: 60%; }
    #dashboard { width: 100%; height: 40%; }
    .floating-window { width: 90%; }
}

/* 定義光圈擴散動畫 */
@keyframes pulse-blue {
    0% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.7);
    }
    70% {
        transform: scale(1);
        box-shadow: 0 0 0 15px rgba(52, 152, 219, 0); /* 光圈擴散並消失 */
    }
    100% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(52, 152, 219, 0);
    }
}

/* --- 定位按鈕互動特效 (方案B) --- */

/* 定義藍色雷達波擴散動畫 */
@keyframes pulse-blue {
    0% {
        box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.7);
    }
    70% {
        box-shadow: 0 0 0 15px rgba(52, 152, 219, 0); /* 擴散並透明 */
    }
    100% {
        box-shadow: 0 0 0 0 rgba(52, 152, 219, 0);
    }
}

/* 確保按鈕本身設定 */
.btn-locate {
    position: relative;
    overflow: visible !important; /* 關鍵：讓光圈可以超出按鈕邊界 */
    transition: background 0.3s, transform 0.2s;
    z-index: 10;
}

/* 當加上 .searching 類別時觸發動畫 */
.btn-locate.searching {
    animation: pulse-blue 1.2s infinite; /* 1.2秒跳動一次 */
    background: #2980b9; /* 顏色變深，表示運作中 */
    cursor: wait;
    pointer-events: none; /* 搜尋期間禁止重複點擊 */
}

/* --- 科技定位特效擴充 (v3.2.7) --- */

/* 1. Dashboard 定位按鈕：雙層科技光圈 */
.btn-locate {
    position: relative;
    overflow: visible !important; /* 確保光圈擴散不被切斷 */
    z-index: 10;
}

/* 搜尋狀態下的雙層動畫 */
.btn-locate.searching::before,
.btn-locate.searching::after {
    content: "";
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    border: 2px solid #3498db;
    border-radius: 4px;
    opacity: 0;
    pointer-events: none;
    z-index: -1;
}

.btn-locate.searching::before {
    animation: tech-pulse 1.5s cubic-bezier(0.24, 0, 0.38, 1) infinite;
}

.btn-locate.searching::after {
    animation: tech-pulse 1.5s cubic-bezier(0.24, 0, 0.38, 1) infinite 0.75s; /* 延遲半週期 */
}

@keyframes tech-pulse {
    0% { transform: scale(1); opacity: 0.8; }
    100% { transform: scale(1.4, 1.8); opacity: 0; }
}

/* 2. 地圖上的科技感標記 (Radar Marker) */
.tech-radar-marker {
    position: relative;
}

/* 中心圓點 */
.radar-center {
    width: 12px; height: 12px;
    background: #3498db;
    border: 2px solid #fff;
    border-radius: 50%;
    box-shadow: 0 0 10px rgba(52, 152, 219, 0.8);
}

/* 地圖脈衝環 */
.radar-ring {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 40px; height: 40px;
    border: 2px solid #3498db;
    border-radius: 50%;
    animation: map-radar 2s ease-out infinite;
}

@keyframes map-radar {
    0% { width: 10px; height: 10px; opacity: 1; border-width: 3px; }
    100% { width: 60px; height: 60px; opacity: 0; border-width: 1px; }
}